#
# Copyright (C) 2015 The Gravitee team (http://gravitee.io)
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#         http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

apiVersion: "gravitee.io/v1alpha1"
kind: GraviteeServices
metadata:
  name: internal-gw-services
spec:
  enabled: true # allow to disable all services of this CRD
  gateway:
    name: internal-gw
    namespace: default
  services:
    - name : my-toto-api
      type: API
      security:
        name: key-less-poc
        resource: internal-gw-plugins
      cors:
        enabled: false
      #vhosts instead entrypoints:
      entrypoints:
        - vhost: "toto.domain.name:82"
          #host instead vhost
          path: "/context/path"
          enabled: true
      paths:
        - prefix: "/*"
          rules: []
        - prefix: "/other-path/"
          rules:
            - methods: ["POST"]
              # pouvoir redef la policy
              policy:
                resource: internal-gw-plugins
                name: rate-limit
                namespace: default
      endpoints:
        ## def proxy conf global ici
        ## http client options aussi
        - name: default-group
          backend-service: # rename en service + ouvrir Ã  external service no k8s
            name: elastic-elasticsearch-master
            port: 9200
            namespace: default
          configuration:
            httpClientOptions:
              connectTimeout: 5000
              idleTimeout: 60000
              keepAlive: true
              readTimeout: 10000
              pipelining: false
              maxConcurrentConnections: 100
              useCompression: true
              followRedirects: false

#            httpProxy:
#              enabled: false
#              useSystemProxy: false
#              host: "null"
#              port: 0
#              type: "HTTP"
#            httpSslClientOptions:
#              trustAll": false
#              hostnameVerifier": false
#              trustStore":  ## will generate a restart of GW pod when update ssl store paths
#                type": "PEM"
#                content": "ggg"
#              keyStore:
#                type: "PEM"
#                certContent: "gggggggg"
#                keyContent: "gggggggg"
